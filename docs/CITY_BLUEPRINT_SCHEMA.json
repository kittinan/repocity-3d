{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RepoCity Blueprint",
  "description": "Schema for normalizing repository data into a 3D city visualization format.",
  "type": "object",
  "required": ["repository", "generated_at", "root"],
  "properties": {
    "repository": {
      "type": "string",
      "description": "Full name of the repository (owner/repo)."
    },
    "generated_at": {
      "type": "string",
      "format": "date-time"
    },
    "meta": {
      "type": "object",
      "description": "Global statistics for the city.",
      "properties": {
        "total_files": { "type": "integer" },
        "total_size_bytes": { "type": "integer" },
        "languages": { 
          "type": "object",
          "additionalProperties": { "type": "integer" },
          "description": "Map of language -> byte count"
        }
      }
    },
    "root": {
      "$ref": "#/definitions/District"
    }
  },
  "definitions": {
    "District": {
      "type": "object",
      "description": "Represents a directory (District).",
      "required": ["name", "path", "type", "children"],
      "properties": {
        "name": { "type": "string" },
        "path": { "type": "string" },
        "type": { "const": "directory" },
        "children": {
          "type": "array",
          "items": {
            "anyOf": [
              { "$ref": "#/definitions/District" },
              { "$ref": "#/definitions/Building" }
            ]
          }
        }
      }
    },
    "Building": {
      "type": "object",
      "description": "Represents a file (Building).",
      "required": ["name", "path", "type", "metrics"],
      "properties": {
        "name": { "type": "string" },
        "path": { "type": "string" },
        "type": { "const": "file" },
        "language": { 
          "type": "string", 
          "description": "Determines the building color." 
        },
        "metrics": {
          "type": "object",
          "required": ["size", "height", "age"],
          "properties": {
            "size": {
              "type": "integer",
              "description": "File size in bytes. Determines footprint."
            },
            "height": {
              "type": "integer",
              "description": "Commit count or complexity metric. Determines building height."
            },
            "age": {
              "type": "integer",
              "description": "Days since last modification. Determines texture (weathering)."
            }
          }
        }
      }
    }
  }
}
